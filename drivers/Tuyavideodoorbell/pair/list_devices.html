<!-- List Discovered Devices -->
<div class="container">
  <h2 data-i18n="pair.list_devices.title"></h2>
  <div id="devices-list"></div>
</div>

<script>
  Homey.showLoadingOverlay();
  Homey.emit('list_devices').then(devices => {
    Homey.hideLoadingOverlay();
    const container = document.getElementById('devices-list');
    
    if (devices && devices.length > 0) {
      const ul = document.createElement('ul');
      devices.forEach(device => {
        const li = document.createElement('li');
        const deviceData = JSON.stringify(device).replace(/'/g, "&#39;");
        li.innerHTML = `
          <h3>${device.name || 'Tuya Doorbell'}</h3>
          <p>ID: ${device.settings.deviceId}</p>
          <p>IP: ${device.settings.ipAddress}</p>
          <button class="button" onclick='Homey.emit("add_device", ${deviceData})' data-i18n="pair.manual_settings.submit"></button>
        `;
        ul.appendChild(li);
      });
      container.appendChild(ul);
    } else {
      const p = document.createElement('p');
      p.setAttribute('data-i18n', 'pair.list_devices.no_devices_found');
      container.appendChild(p);
    }
  }).catch(error => {
    Homey.hideLoadingOverlay();
    Homey.alert(error);
  });
</script>
